---
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";

type Props = {
  testimonials: { text: string; name: string }[];
};
const props = Astro.props;
const images = import.meta.glob<{ default: ImageMetadata }>(
  `/src/assets/home/testimonialsBG/verbatim-*.{jpeg,jpg,png,gif,svg}`,
);
---

<section class="testimonial relative !py-[3.91rem]" data-slide-motion="static">
  <div
    class="testimonial-container grid touch-manipulation snap-x snap-mandatory grid-flow-col overflow-auto overflow-x-hidden overflow-y-hidden scroll-smooth"
    data-slide-container=""
  >
    {/* <!-- Slide cards --> */}
    {
      props.testimonials.map(
        (testimonial: { text: string; name: string }, idx) => {
          const file = `/src/assets/home/testimonialsBG/verbatim-${(idx % Math.round(Object.keys(images).length)) + 1}.svg`;
          const image = images[file]();
          return (
            <div class="testimonial__card relative snap-start duration-1000 ease-in-out">
              <div class="testimonial__content relative z-10">
                <div class="testimonial__text">{testimonial.text}</div>
                <div class={`testimonial__author`}>{testimonial.name}</div>
              </div>
              <Image
                src={image}
                alt={testimonial.name}
                width={400}
                height={400}
                class={`absolute bottom-0 left-0 z-0`}
              />
            </div>
          );
        },
      )
    }
  </div>
  {/* <!-- Slide buttons --> */}
  <button
    type="button"
    class="group absolute left-3 top-0 z-20 flex h-full cursor-pointer items-center
      justify-center focus:outline-none lg:-left-5"
    data-slide-previous=""
  >
    <Icon
      name="chevron"
      width={35}
      height={58}
      class="rotate-180 text-neutre hover:opacity-50"
      aria-hidden="true"
    />
    <span class="sr-only">Previous</span>
  </button>
  <button
    type="button"
    class="group absolute right-3 top-0 z-20 flex h-full cursor-pointer items-center justify-center focus:outline-none lg:-right-5"
    data-slide-next=""
  >
    <Icon
      name="chevron"
      width={35}
      height={58}
      class="text-neutre hover:opacity-50"
      aria-hidden="true"
    />
    <span class="sr-only">Next</span>
  </button>
</section>
<script>
  //Get all slideContainers
  const slideContainers = document.querySelectorAll("[data-slide-container]");
  const slideDistance = window.screen.availWidth / 4;
  // Iterate over each container, incase there are more than one carousels in a page
  slideContainers.forEach((container) => {
    let containerMotion =
      container.parentElement?.attributes["data-slide-motion"].value;
    //Implement automatic slide
    if (containerMotion == "slide") {
      setInterval(function () {
        container.scrollLeft += slideDistance;
      }, 1000);
    }
    let nextButton = document.querySelectorAll("[data-slide-next]")[0];
    let previousButton = document.querySelectorAll("[data-slide-previous]")[0];

    //add a click event to each of the slide
    nextButton.addEventListener("click", () => {
      container.scrollLeft += slideDistance;
    });

    previousButton.addEventListener("click", () => {
      container.scrollLeft -= slideDistance;
    });
  });
</script>
